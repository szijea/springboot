<!-- test.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>系统测试工具</title>
    <link rel="stylesheet" href="css/tailwind.css" />
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/theme-enhanced.css" />
    <link rel="stylesheet" href="css/theme-premium.css" />
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>(function(){if(!window.tailwind){window.tailwind={config:{}};} if(!window.tailwind.config){window.tailwind.config={};}})();</script>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <style>
      .main-content{flex:1 1 auto;padding:1.5rem;min-height:calc(100vh - 64px);overflow-y:auto;scrollbar-width:thin;}
      .main-content::-webkit-scrollbar{width:8px}
      .main-content::-webkit-scrollbar-track{background:#f5f5f5;border-radius:4px}
      .main-content::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:4px}
      .main-content::-webkit-scrollbar-thumb:hover{background:#9ca3af}
    </style>
</head>
<body class="font-inter bg-gray-50 text-gray-800 min-h-screen flex enhanced-ui theme-modern theme-premium page-enter">
<a href="#main-content" class="skip-link">跳到主内容</a>
<div class="scroll-progress" id="scroll-progress"></div>
<div id="common-nav" data-active="test"></div>
<div id="notification-panel" class="hidden absolute top-20 right-6 bg-white shadow-lg rounded-lg p-4 w-64 text-sm">
  <div class="font-medium mb-2">通知面板</div>
  <p class="text-gray-500">暂无通知</p>
</div>
<main class="flex-1 flex flex-col pt-16">
  <div class="main-content" id="main-content"><div class="container-xl section-gap">
    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4 action-bar">
      <div>
        <h2 class="page-title font-bold page-title-decor">后端连接测试</h2>
        <p class="text-gray-500">快速验证 API 与数据库可用性</p>
      </div>
      <div class="flex gap-3">
        <button class="btn btn-outline" onclick="location.reload()"><i class="fa fa-refresh"></i> 刷新页面</button>
      </div>
    </div>

    <div class="cozy-grid cols-3">
      <div class="card card-interactive elevation-2 p-6"><h3 class="font-bold mb-2 text-sm">基础连通性</h3><p class="text-xs text-gray-500 mb-4">测试 /api/health</p><button class="btn btn-primary text-xs" onclick="testHealth()">测试</button></div>
      <div class="card card-interactive elevation-2 p-6"><h3 class="font-bold mb-2 text-sm">数据库连接</h3><p class="text-xs text-gray-500 mb-4">测试 /api/test/db</p><button class="btn btn-primary text-xs" onclick="testDatabase()">测试</button></div>
      <div class="card card-interactive elevation-2 p-6"><h3 class="font-bold mb-2 text-sm">药品搜索</h3><p class="text-xs text-gray-500 mb-4">测试 /api/medicines/search</p><button class="btn btn-primary text-xs" onclick="testMedicineSearch()">测试</button></div>
    </div>
    <div class="card p-6">
      <h3 class="font-bold mb-4 text-lg">测试结果</h3>
      <div id="result" class="text-sm whitespace-pre-wrap bg-gray-50 border border-gray-200 rounded p-4 min-h-[120px]"></div>
    </div>
  </div></div>
  </main>
<script src="js/common-nav.js"></script>
<script>
async function safeFetch(url){
  const tenant=localStorage.getItem('selectedTenant')||'default';
  return fetch(url,{headers:{'X-Shop-Id':tenant}});
}
async function testHealth(){await runTest('/api/health');}
async function testDatabase(){await runTest('/api/test/db');}
async function testMedicineSearch(){await runTest('/api/medicines/search?keyword=维');}
async function runTest(endpoint){
  const box=document.getElementById('result');
  box.textContent='正在请求: '+endpoint+'...';
  try {
    const resp=await safeFetch(endpoint);
    const text=await resp.text();
    box.textContent='状态: '+resp.status+'\n'+text;
  } catch(e){
    box.textContent='请求失败: '+e.message;
  }
}
</script>
<script>
    (function(){
      const bar=document.getElementById('scroll-progress');
      function update(){const h=document.documentElement.scrollHeight - window.innerHeight;const sc=window.scrollY;bar&&(bar.style.width=(h>0?(sc/h)*100:0)+'%');}
      window.addEventListener('scroll',update,{passive:true});update();
      if(!document.getElementById('theme-toggle')){const btn=document.createElement('button');btn.id='theme-toggle';btn.className='theme-toggle';btn.innerHTML='<i class="fa fa-moon-o"></i>';btn.onclick=()=>{const dark=document.documentElement.classList.toggle('dark');btn.innerHTML='<i class="fa '+(dark?'fa-sun-o':'fa-moon-o')+'"></i>';};document.body.appendChild(btn);} })();
  </script>
<script>(function(){var nav=document.getElementById('common-nav');if(nav&&!nav.classList.contains('nav-glass'))nav.classList.add('nav-glass');})();</script>
<script src="js/a11y.js" defer></script>
</body>
</html>